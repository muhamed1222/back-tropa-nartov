#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Strapi —á–µ—Ä–µ–∑ PostgreSQL
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env

cd "$(dirname "$0")/.."

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ -f .env ]; then
    export $(cat .env | grep -v '^#' | xargs)
fi

DB_USER=${POSTGRES_USER:-postgres}
DB_PASSWORD=${POSTGRES_PASSWORD:-postgres}
DB_NAME=${POSTGRES_DB:-tropa_nartov}

echo "üöÄ –î–æ–±–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö..."

# –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–π–æ–Ω—ã
docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME <<'SQL'
INSERT INTO areas (name, description, created_at, updated_at) VALUES
('–ü—Ä–∏—ç–ª—å–±—Ä—É—Å—å–µ', '–†–∞–π–æ–Ω –≤–æ–∫—Ä—É–≥ –≥–æ—Ä—ã –≠–ª—å–±—Ä—É—Å', NOW(), NOW()),
('–î–æ–º–±–∞–π', '–î–æ–º–±–∞–π—Å–∫–∏–π —Ä–∞–π–æ–Ω', NOW(), NOW()),
('–ê—Ä—Ö—ã–∑', '–ê—Ä—Ö—ã–∑—Å–∫–∏–π —Ä–∞–π–æ–Ω', NOW(), NOW()),
('–ß–µ–≥–µ–º—Å–∫–æ–µ —É—â–µ–ª—å–µ', '–ß–µ–≥–µ–º—Å–∫–æ–µ —É—â–µ–ª—å–µ', NOW(), NOW())
ON CONFLICT (name) DO NOTHING;
SQL

# –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME <<'SQL'
INSERT INTO categories (name, description, created_at, updated_at) VALUES
('–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–µ–Ω–∏—è', NOW(), NOW()),
('–ü—Ä–∏—Ä–æ–¥–∞', '–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã', NOW(), NOW()),
('–ö—É–ª—å—Ç—É—Ä–∞', '–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã', NOW(), NOW()),
('–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', '–ú–µ—Å—Ç–∞ –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π', NOW(), NOW())
ON CONFLICT (name) DO NOTHING;
SQL

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø—ã
docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME <<'SQL'
INSERT INTO types (name, entity_type, description, created_at) VALUES
('–ü–µ—à–∏–π –ø–æ—Ö–æ–¥', 'route', '–ü–µ—à–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø–æ –≥–æ—Ä–∞–º –∏ –ª–µ—Å–∞–º', NOW()),
('–í–µ–ª–æ–º–∞—Ä—à—Ä—É—Ç', 'route', '–í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ —Ç—Ä–∞—Å—Å—ã', NOW()),
('–ê–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π', 'route', '–ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –ø–æ–µ–∑–¥–æ–∫', NOW())
ON CONFLICT (name) DO NOTHING;
SQL

# –ü–æ–ª—É—á–∞–µ–º ID –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
AREA_ID=$(docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME -t -c "SELECT id FROM areas WHERE name = '–ü—Ä–∏—ç–ª—å–±—Ä—É—Å—å–µ' LIMIT 1;" | tr -d ' ')
TYPE_ID=$(docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME -t -c "SELECT id FROM types WHERE name = '–ü–µ—à–∏–π –ø–æ—Ö–æ–¥' LIMIT 1;" | tr -d ' ')
CHEGEM_AREA_ID=$(docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME -t -c "SELECT id FROM areas WHERE name = '–ß–µ–≥–µ–º—Å–∫–æ–µ —É—â–µ–ª—å–µ' LIMIT 1;" | tr -d ' ')

# –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Å—Ç–∞
docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME <<SQL
INSERT INTO places (name, type, description, overview, history, address, hours, weekend, entry, contacts, contacts_email, latitude, longitude, rating, type_id, area_id, is_active, created_at, updated_at) VALUES
('–ü–∞—Ä–∫ –ê—Ç–∞–∂—É–∫–∏–Ω—Å–∫–∏–π', '–ø–∞—Ä–∫', '–ö—Ä—É–ø–Ω–µ–π—à–∏–π –ø–∞—Ä–∫ –Ω–∞ –°–µ–≤–µ—Ä–Ω–æ–º –ö–∞–≤–∫–∞–∑–µ —Å –±–æ–≥–∞—Ç–æ–π —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é', '–ü–ª–æ—â–∞–¥—å 250 –≥–µ–∫—Ç–∞—Ä–æ–≤, –∞–ª–ª–µ–∏, —Ñ–æ–Ω—Ç–∞–Ω—ã, –æ–∑–µ—Ä–∞, –∑–æ–æ–ø–∞—Ä–∫ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', '–ó–∞–ª–æ–∂–µ–Ω –≤ 1847 –≥–æ–¥—É –∫–∞–∫ –ö–∞–∑–µ–Ω–Ω—ã–π —Å–∞–¥, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–∏–ª –≤ 1920 –≥–æ–¥—É', '–≥. –ù–∞–ª—å—á–∏–∫, —É–ª. –¢–æ–ª—Å—Ç–æ–≥–æ, 2', '06:00-24:00', '–ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö', '–°–≤–æ–±–æ–¥–Ω—ã–π', '+78662225566', 'park@nalchik.ru', 43.4925, 43.6123, 4.8, ${TYPE_ID:-1}, ${AREA_ID:-1}, true, NOW(), NOW()),
('–ö–∞—Ñ–µ "–ì–æ—Ä–Ω—ã–π –í–µ—Ç–µ—Ä–æ–∫"', '–∫–∞—Ñ–µ', '–£—é—Ç–Ω–æ–µ –∫–∞—Ñ–µ —Å –∫–∞–≤–∫–∞–∑—Å–∫–æ–π –∫—É—Ö–Ω–µ–π –∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–º –≤–∏–¥–æ–º', '–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ –±–ª—é–¥–∞ –∫–∞–≤–∫–∞–∑—Å–∫–æ–π –∫—É—Ö–Ω–∏, —Å–≤–µ–∂–∞—è –≤—ã–ø–µ—á–∫–∞, –∫–æ—Ñ–µ –ø–æ-–≤–æ—Å—Ç–æ—á–Ω–æ–º—É', '–û—Å–Ω–æ–≤–∞–Ω–æ –≤ 1995 –≥–æ–¥—É, —Å —Ç–µ—Ö –ø–æ—Ä —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–∏–º –∏–∑ –ª—é–±–∏–º—ã—Ö –º–µ—Å—Ç –∂–∏—Ç–µ–ª–µ–π –∏ –≥–æ—Å—Ç–µ–π –≥–æ—Ä–æ–¥–∞', '–≥. –ù–∞–ª—å—á–∏–∫, –ø—Ä. –õ–µ–Ω–∏–Ω–∞, 25', '08:00-23:00', '–ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö', '–°–≤–æ–±–æ–¥–Ω—ã–π', '+78662223344', 'gorniy-veterok@mail.ru', 43.4981, 43.7189, 4.5, ${TYPE_ID:-1}, ${AREA_ID:-1}, true, NOW(), NOW()),
('–ú—É–∑–µ–π –ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä–∏–∏', '–º—É–∑–µ–π', '–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º—É–∑–µ–π —Å –±–æ–≥–∞—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∫—É–ª—å—Ç—É—Ä—ã –Ω–∞—Ä–æ–¥–æ–≤ –ö–ë–†', '–≠–∫—Å–ø–æ–∑–∏—Ü–∏–∏ –ø–æ –∞—Ä—Ö–µ–æ–ª–æ–≥–∏–∏, —ç—Ç–Ω–æ–≥—Ä–∞—Ñ–∏–∏, –∏—Å–∫—É—Å—Å—Ç–≤—É –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏', '–û—Å–Ω–æ–≤–∞–Ω –≤ 1921 –≥–æ–¥—É, –≤ —Ñ–æ–Ω–¥–∞—Ö –±–æ–ª–µ–µ 150 —Ç—ã—Å—è—á —ç–∫—Å–ø–æ–Ω–∞—Ç–æ–≤', '–≥. –ù–∞–ª—å—á–∏–∫, —É–ª. –ì–æ—Ä—å–∫–æ–≥–æ, 62', '10:00-18:00', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–ü–ª–∞—Ç–Ω—ã–π', '+78662227788', 'museum@kbr.ru', 43.5050, 43.6250, 4.2, ${TYPE_ID:-1}, ${AREA_ID:-1}, true, NOW(), NOW()),
('–†–µ—Å—Ç–æ—Ä–∞–Ω "–≠–ª—å–±—Ä—É—Å"', '—Ä–µ—Å—Ç–æ—Ä–∞–Ω', '–†–µ—Å—Ç–æ—Ä–∞–Ω –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫—É—Ö–Ω–∏ —Å –∫–∞–≤–∫–∞–∑—Å–∫–∏–º –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º—Å—Ç–≤–æ–º', '–ë–ª—é–¥–∞ –∫–∞–±–∞—Ä–¥–∏–Ω—Å–∫–æ–π, –±–∞–ª–∫–∞—Ä—Å–∫–æ–π –∏ –æ–±—â–µ–∫–∞–≤–∫–∞–∑—Å–∫–æ–π –∫—É—Ö–Ω–∏, –∂–∏–≤–∞—è –º—É–∑—ã–∫–∞', '–†–∞–±–æ—Ç–∞–µ—Ç —Å 1985 –≥–æ–¥–∞, –∏–∑–≤–µ—Å—Ç–µ–Ω —Å–≤–æ–∏–º–∏ —à–µ—Ñ-–ø–æ–≤–∞—Ä–∞–º–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è', '–≥. –ù–∞–ª—å—á–∏–∫, —É–ª. –ö–∞–±–∞—Ä–¥–∏–Ω—Å–∫–∞—è, 45', '11:00-02:00', '–ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö', '–°–≤–æ–±–æ–¥–Ω—ã–π', '+78662229900', 'elbrus-rest@yandex.ru', 43.4900, 43.6300, 3.9, ${TYPE_ID:-1}, ${AREA_ID:-1}, true, NOW(), NOW()),
('–°–∫–≤–µ—Ä "–î—Ä—É–∂–±—ã"', '–ø–∞—Ä–∫', '–£—é—Ç–Ω—ã–π —Å–∫–≤–µ—Ä –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≥—É–ª–æ–∫ –∏ –æ—Ç–¥—ã—Ö–∞', '–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è —Å —Ñ–æ–Ω—Ç–∞–Ω–æ–º, —Å–∫–∞–º–µ–π–∫–∞–º–∏ –∏ –¥–µ—Ç—Å–∫–æ–π –ø–ª–æ—â–∞–¥–∫–æ–π', '–°–æ–∑–¥–∞–Ω –≤ 1970-—Ö –≥–æ–¥–∞—Ö –≤ —á–µ—Å—Ç—å –¥—Ä—É–∂–±—ã –Ω–∞—Ä–æ–¥–æ–≤ –ö–∞–≤–∫–∞–∑–∞', '–≥. –ù–∞–ª—å—á–∏–∫, –ø–ª. –°–æ–≥–ª–∞—Å–∏—è', '–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ', '–ë–µ–∑ –≤—ã—Ö–æ–¥–Ω—ã—Ö', '–°–≤–æ–±–æ–¥–Ω—ã–π', '', '', 43.5100, 43.6100, 4.0, ${TYPE_ID:-1}, ${AREA_ID:-1}, true, NOW(), NOW())
ON CONFLICT DO NOTHING;
SQL

# –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç—ã
docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME <<SQL
INSERT INTO routes (name, description, overview, history, distance, duration, type_id, area_id, rating, is_active, created_at, updated_at) VALUES
('–í–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ –≠–ª—å–±—Ä—É—Å', '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –∫ –≤—ã—Å–æ—á–∞–π—à–µ–π —Ç–æ—á–∫–µ –ï–≤—Ä–æ–ø—ã —á–µ—Ä–µ–∑ –∂–∏–≤–æ–ø–∏—Å–Ω—ã–µ –ª–µ–¥–Ω–∏–∫–∏ –∏ –≥–æ—Ä–Ω—ã–µ –ø–µ—Ä–µ–≤–∞–ª—ã', '–ú–∞—Ä—à—Ä—É—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç –ø–æ—Å–µ–ª–∫–∞ –¢–µ—Ä—Å–∫–æ–ª –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –ø—Ä–∏—é—Ç –ë–æ—á–∫–∏, —Å–∫–∞–ª—ã –ü–∞—Å—Ç—É—Ö–æ–≤–∞ –¥–æ –∑–∞–ø–∞–¥–Ω–æ–π –≤–µ—Ä—à–∏–Ω—ã –≠–ª—å–±—Ä—É—Å–∞', '–ü–µ—Ä–≤–æ–µ —É—Å–ø–µ—à–Ω–æ–µ –≤–æ—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –Ω–∞ –≠–ª—å–±—Ä—É—Å –±—ã–ª–æ —Å–æ–≤–µ—Ä—à–µ–Ω–æ –≤ 1829 –≥–æ–¥—É —ç–∫—Å–ø–µ–¥–∏—Ü–∏–µ–π –†–æ—Å—Å–∏–π—Å–∫–æ–π –∞–∫–∞–¥–µ–º–∏–∏ –Ω–∞—É–∫ –ø–æ–¥ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –≥–µ–Ω–µ—Ä–∞–ª–∞ –ì. –ê. –≠–º–º–∞–Ω—É—ç–ª—è', 22.5, 48.0, ${TYPE_ID:-1}, ${AREA_ID:-1}, 4.9, true, NOW(), NOW()),
('–ß–µ–≥–µ–º—Å–∫–∏–µ –≤–æ–¥–æ–ø–∞–¥—ã', '–ü—É—Ç—å –∫ –≤–µ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–æ–¥–æ–ø–∞–¥–∞–º –≤ –∂–∏–≤–æ–ø–∏—Å–Ω–æ–º –ß–µ–≥–µ–º—Å–∫–æ–º —É—â–µ–ª—å–µ, –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É —Å–≤–æ–∏–º–∏ —Å—É—Ä–æ–≤—ã–º–∏ —Å–∫–∞–ª–∞–º–∏ –∏ –±—É—Ä–Ω–æ–π —Ä–µ–∫–æ–π', '–ú–∞—Ä—à—Ä—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–¥–æ–ª—å —Ä–µ–∫–∏ –ß–µ–≥–µ–º —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Å–∫–∞–¥–æ–≤ –≤–æ–¥–æ–ø–∞–¥–æ–≤, —Å–∞–º—ã–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö - –î–µ–≤–∏—á—å–∏ –∫–æ—Å—ã', '–ß–µ–≥–µ–º—Å–∫–æ–µ —É—â–µ–ª—å–µ –∏–∑–¥–∞–≤–Ω–∞ –±—ã–ª–æ –∑–∞—Å–µ–ª–µ–Ω–æ –±–∞–ª–∫–∞—Ä—Ü–∞–º–∏, –æ —á–µ–º —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤—É—é—Ç –¥—Ä–µ–≤–Ω–∏–µ —Å–∫–ª–µ–ø—ã –∏ –±–∞—à–Ω–∏', 8.2, 4.5, ${TYPE_ID:-1}, ${CHEGEM_AREA_ID:-4}, 4.7, true, NOW(), NOW())
ON CONFLICT DO NOTHING;
SQL

echo ""
echo "‚úÖ –î–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã!"
echo ""
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
docker-compose exec -T -e PGPASSWORD=$DB_PASSWORD postgres psql -h localhost -U $DB_USER -d $DB_NAME -c "SELECT COUNT(*) as places FROM places; SELECT COUNT(*) as routes FROM routes; SELECT COUNT(*) as areas FROM areas; SELECT COUNT(*) as categories FROM categories; SELECT COUNT(*) as types FROM types;" 2>&1 | grep -E "places|routes|areas|categories|types" | head -5

echo ""
echo "üìù –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Strapi –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏: http://localhost:1337/admin"
echo "üì° –ò–ª–∏ —á–µ—Ä–µ–∑ API: http://localhost:1337/api/places"

